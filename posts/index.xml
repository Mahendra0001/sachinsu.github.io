<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Sachin Sunkle</title><link>https://sachinsu.github.io/posts/</link><description>Recent content in Posts on Sachin Sunkle</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 15 Oct 2020 10:25:04 +0530</lastBuildDate><atom:link href="https://sachinsu.github.io/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Validating urls from 'Useful Links' section using bash / command line tools</title><link>https://sachinsu.github.io/posts/urlhealthchecks/</link><pubDate>Thu, 15 Oct 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/urlhealthchecks/</guid><description>Background I started this blog, https://sachinsu.github.io few months back .
In this relatively short period of time, Blog has sizeable number of useful links across various categories in addition to the detailed blog post like this one.
As an ongoing activity, I think that it is necessary to verify links mentioned on this blog.
So how can it be done ? obviously one way is to do it manually by visiting each link and updating/removing those that are no longer available.</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>I started this blog, <a href="https://sachinsu.github.io">https://sachinsu.github.io</a> few months back .</p>
<p>In this relatively short period of time, Blog has sizeable number of useful links across various categories in addition to the detailed blog post like this one.</p>
<p>As an ongoing activity, I think that it is necessary to verify links mentioned on this blog.</p>
<p>So how can it be done ? obviously one way is to do it manually by visiting each link and updating/removing those that are no longer available. but there is always of better way of doing things.</p>
<p>The requirement is to,</p>
<ul>
<li>Parse all the files to links (being in Markdown links will be enclosed in brackets)</li>
<li>Send request to each link and verify if its active using HTTP Status (say 200 or 302)</li>
</ul>
<h2 id="approach">Approach</h2>
<p>Enter Automation !!</p>
<p>It is possible to write a utility/tool (or it might be already available) or can good old command line utlities be used for this task?</p>
<p>I decided to go for dos / shell script way and surprisingly all the necessary tools are already available.</p>
<p>Below is single command line that fulfils the requirement,</p>
<p><code>grep -E -i -w &quot;http|https&quot; *.md | sed 's/](http/\nhttp/g' | sed 's/)/\n/g' | grep ^http | xargs curl -s -I  -w 'URL:%{url_effective} - %{http_code}\n' | grep ^URL:</code></p>
<p>In above chain,</p>
<ul>
<li>
<p>I am using excellent <a href="https://cmder.net/">Cmder</a> console emulator, which also makes above nice tools (grep, sed etc.) available on Windows.</p>
</li>
<li>
<p><a href="https://man7.org/linux/man-pages/man1/grep.1.html">grep</a> -E -i -w &ldquo;http|https&rdquo; *.md  - this command extracts all the lines containing <code>http(s)</code> from all the markdown (.md) files</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">Pipe |</a> - Pipe command streams output of command to the next one.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Sed">sed</a> &rsquo;s/](http/\nhttp/g' - this sed (stream editor) command adds line break before <code>http</code> for better extraction.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Sed">sed</a> &rsquo;s/)/\n/g' - this sed (stream editor) command removes trailing <code>)</code> bracket.</p>
</li>
<li>
<p><a href="https://man7.org/linux/man-pages/man1/grep.1.html">grep</a> ^http  - this command removes all lines not containing <code>http</code>.</p>
</li>
<li>
<p><a href="https://man7.org/linux/man-pages/man1/xargs.1.html">xargs</a> - xargs is a command on Unix and most Unix-like operating systems used to build and execute commands from standard input.</p>
</li>
<li>
<p><a href="https://curl.haxx.se/">curl</a> -s -I  -w &lsquo;URL:%{url_effective} &mdash;&gt; %{http_code}&rsquo;' - previously used <code>xargs</code> command feeds each line (url) to this command as last argument. This command sends tcp request to the URL and prints out http status code along with URL.</p>
</li>
<li>
<p><a href="https://man7.org/linux/man-pages/man1/grep.1.html">grep</a> ^URL: - For some reason, CURL outputs content even if <code>-s</code> (silent) parameter is passed. Hence, this grep command is used to ignore all lines not containing URL and HTTP Status.</p>
</li>
</ul>
<p>The output is as below,</p>
<figure>
    <img src="/images/urloutput.png"/> <figcaption>
            <h4>List of URLs with HTTP Status code</h4>
        </figcaption>
</figure>

<p>So, It is  possible to quickly come up with this using built-in tools if writing a program is not an option or cumbersome for task at hand.</p>
<p>As a next step, Plan is to automatically run this script as part of Github Build and notify in case of any URL is failing so that appropriate action can be taken.</p>
<p>Let me know (in comments) if you are aware of any alternate better way of achieving this.</p>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Trobleshooting TCP Connection request time outs</title><link>https://sachinsu.github.io/posts/connectiontimeouts/</link><pubDate>Tue, 25 Aug 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/connectiontimeouts/</guid><description>Background I recently had opportunity to support team who has been battling with Intermittent (scary i know :)) issues with TCP connectivity in Production.
Simplified deployment Architecture is as below,
High Level Architecture Technology Stack used is Microsoft .NET Framework 4.8 using ODP.NET for Oracle Connectivity (Oracle Server is 8 CPU box). Each of Web Servers in cluster have IIS hosted on it with multiple Applications (Application domains) serving HTTP(s) based traffic.</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>I recently had opportunity to support team who has been battling with Intermittent (scary i know :)) issues with TCP connectivity in Production.</p>
<p>Simplified deployment Architecture is as below,</p>
<figure>
    <img src="/images/conntimeoutarch.png"/> <figcaption>
            <h4>High Level Architecture</h4>
        </figcaption>
</figure>

<p>Technology Stack used is Microsoft .NET Framework 4.8 using ODP.NET for Oracle Connectivity (Oracle Server is 8 CPU box). Each of Web Servers in cluster have IIS hosted on it with multiple Applications (Application domains) serving HTTP(s) based traffic. These applications connect to Oracle Database.</p>
<p>Team is experienced in developing and running .NET Apps, but they needed help to diagnose and fix &ldquo;Connection request timed out&rdquo; exceptions being thrown while connecting to backend database.</p>
<h2 id="problem-statement">Problem Statement</h2>
<p>Host of .NET Applications (Web Applications, Web APIs) connect to Oracle Database. Each of them use <a href="https://www.oracle.com/database/technologies/appdev/dotnet/odp.html">ODP.NET</a>. ODP.NET maintains connection pool per Application domain (Database resident Connection pool is not used). Some of these applications receive high number of requests per second compared to others.</p>
<p><code>Oracle.ManagedDataAccess.Client.OracleException (0x80004005): Connection request timed out....</code> has been reported randomly which results in failure of business transactions. ODP.NET provides extensive trace and along with above trace also contains <code>OracleInternal.Network.NetworkException (0x80004005): Network Transport: TCP transport address connect failure ---&gt; System.Net.Sockets.SocketException (0x80004005): A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond</code></p>
<p>Specifically, Applications, receiving less traffic, were reporting it often compared to those with high traffic.</p>
<h2 id="approach">Approach</h2>
<ul>
<li>Simulate the Exception in Test Environment - We decided to try and simulate this exception in a Test Environment. Test environment is scaled down (50%) compared to production. Random Exceptions in production could not be simulated due to lack of Test Automation. for example, In Production, each server receives traffic for multiple HTTP End points whereas in Test environment, load testing was being done only against Single Application.</li>
</ul>
<p>This was like a end of the road since simulation would have greatly helped in diagnosing the issue. However, the show must go on so we decided to,</p>
<ul>
<li>
<p>Check online documentation regarding this exception,</p>
<ul>
<li>
<p>&ldquo;Pooled&rdquo; or &ldquo;Non-pooled&rdquo; Connection - Whenever, ODP.NET raises &ldquo;..timed out&rdquo; error, it diffrentiates the same to indicate whether error is due to delay in retrieving connection from pool or if it is due to delay from the database server (Ref: <a href="https://docs.oracle.com/en/database/oracle/oracle-data-access-components/19.3/odpnt/featConnecting.html#GUID-1152D13D-464C-4FE7-9949-32FCA9572B59">Here</a>). From this, it was clear that issue is clearly due to delay in obtaining response from database server.While this was happening , Database server (8 CPU Core box) was reporting less than 50% CPU Usage but it still had large number of inactive sessions originated from IIS Servers.</p>
</li>
<li>
<p>Since the exception was reported frequently in low traffic applications, it was decided to track and verify the same on firewall and database server,</p>
<ul>
<li>
<p>Firewall - Firewall had TCP Timeout of 30 minutes and  maintains detailed log of sessions. Quick analysis of it revealed that,</p>
<ul>
<li>Production Environment - Unusually high number of sessions were being destroyed due to &ldquo;Age out&rdquo; (i.e. time out)</li>
<li>Test Environment - No abnormal activity was reported. Most probably because of differences in traffic.</li>
</ul>
</li>
<li>
<p>Database Server - Listener Log on Oracle Database server did not had any log entry for request at the precise time when Application(s) had reported Exception.</p>
</li>
</ul>
</li>
<li>
<p>Next is to check settings in Application for connectivity with Oracle. Though ODP.NET does not have any direct  &ldquo;Time out&rdquo; or &ldquo;Time to live&rdquo; settings, it does provide few parameters that can influence it,</p>
<ul>
<li>&ldquo;Connection Lifetime&rdquo; - ODP.NET uses this whenever Connection is closed and disposed by the Application. It will be destroyed (after maintaining number of connections as per &ldquo;Min Pool Size&rdquo;)  if it has exceeded life time. For whatever reasons, this was set to unusually high duration (i.e. 90000 seconds).</li>
<li>&ldquo;Connection Timeout&rdquo; - Period for which ODP.NET waits for the connection to be made available. This was set to 60 Seconds.</li>
</ul>
</li>
<li>
<p>Oracle has articles titled &ldquo;ODP-1000 &ldquo;Connection Request Timed Out&rdquo; Explained&rdquo; and &ldquo;Resolving Problems with Connection Idle Timeout With Firewall (Doc ID 257650.1)&rdquo; where it primarily recommends measures for tuning Application as well as database.</p>
</li>
</ul>
<p>On the basis of above, it was decided to modify the code for below,</p>
<ul>
<li>Thorough code review to verify that every ODP.NET Project is closed/disposed.</li>
<li>Upgrade ODP.NET to latest version (v19.8.0 as of this writing)</li>
<li>Turn &ldquo;KeepAlive&rdquo; while connecting to database</li>
<li>Leverage ODP.NET tracing in case of exception</li>
<li>Modify the connection lifetime to be less than time out at firewall and increase the &ldquo;Time out&rdquo; period.</li>
<li>Introduce Retry functionality using Excellent <a href="https://github.com/App-vNext/Polly">Polly</a> library with exponential back-off.</li>
</ul>
<p><code>
<iframe src="//carbon.now.sh/embed/d3888ab4418b937a650e880ec4682653?filename=extensions.cs"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>
</code></p>
<p>These changes have been deployed to production and so far % of &ldquo;Connection Request Timed out&rdquo; errors have gone down significantly.</p>
</li>
</ul>
<h2 id="wrap-up">Wrap up</h2>
<p>Some key areas of focus are,</p>
<ul>
<li>For a distributed system, Always validate assumptions by dignosing end to end.</li>
<li>Plan to have test automation readyness to simulate production like load.</li>
<li>Monitoring the behavior end to end using logs.</li>
<li>Currently, Pool settings across applications is not optimal going by Oracle Real world Guidelines, also be mindful of <a href="https://docs.oracle.com/en/database/oracle/oracle-database/18/adfns/connection_strategies.html">Connection Storms</a></li>
</ul>
<p>Happy Troubleshooting !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Tool to mass DM followers on Twitter in Go</title><link>https://sachinsu.github.io/posts/massdmgolang/</link><pubDate>Sat, 25 Jul 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/massdmgolang/</guid><description>Background I recently came across bounty by Balaji Srinivasan to send Direct Message to all twitter followers. Currently, i do not intend to participate in bounty and this is mere exercise.
This is an attempt to write CLI tool in Golang in response to it.
For detailed requirements, refer here
Approach In Brief,
CLI should,
accept arguments like Twitter API Key,Auth token, DM Message Download all followers (with profile details) Rank them by Criteria (e.</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>I recently came across bounty by <a href="https://twitter.com/balajis/status/1271945241881268224?s=20">Balaji Srinivasan</a> to send Direct Message to all twitter followers. <em>Currently, i do not intend to participate in bounty and this is mere exercise.</em></p>
<p>This is an attempt to write CLI tool in <a href="https://golang.org">Golang</a> in response to it.</p>
<p>For detailed requirements, refer <a href="https://github.com/balajis/twitter-export">here</a></p>
<h2 id="approach">Approach</h2>
<p>In Brief,</p>
<ul>
<li>
<p>CLI should,</p>
<ul>
<li>accept arguments like Twitter API Key,Auth token, DM Message</li>
<li>Download all followers (with profile details)</li>
<li>Rank them by Criteria (e.g. Location)</li>
<li>Send each follower a DM with provided message (upto daily DM Limit)</li>
<li>be easy to use and maintain</li>
</ul>
</li>
<li>
<p>Notes,</p>
<ul>
<li>Due to Daily DM Limit, Follower details will have to be persisted alongside flag indicating if DM has been sent. SQLIte is used from simplicity perspective.</li>
<li>There should be a scheduled job that will send the DM upto daily DM Limit. At the same time, it needs to refetch any new followers and push them in the flow (reconcile).</li>
<li>Potentially, this could be extended to other social media providers other than twitter.</li>
<li>Milestones,
<ul>
<li>Create code structure
<ul>
<li>Plan is to have separation between CLI &amp; have twitter as go package</li>
</ul>
</li>
<li>Accept Arguments and Connect to Twitter</li>
<li>Study and complete follower retrieval</li>
<li>Ranking of followers</li>
<li>Persisting followers</li>
<li>Sending DM upto Daily limit</li>
</ul>
</li>
<li>Rules,
<ul>
<li>Use golang&rsquo;s in-built packages as much as possible</li>
<li>Every milestone to have associated Unit test cases</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="current-status">Current Status</h2>
<p>The code is ready and functionality to retrieve followers and saving in local DB is tested. Code to send DM is not yet tested as it will require setting up dummy twitter account.</p>
<h2 id="roadmap">Roadmap</h2>
<ul>
<li>In addition to CLI, Expose the utility as responsive Web Application</li>
<li>Possibly extend this to social media platforms other than <a href="https://twitter.com">Twitter</a></li>
</ul>
<p>Have a look at code on <a href="https://github.com/sachinsu/twitterexport">Github</a> and let me know what you think.</p>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Web Security Measures in ASP.NET Applications</title><link>https://sachinsu.github.io/posts/websecurity/</link><pubDate>Thu, 04 Jun 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/websecurity/</guid><description>At my current workplace, All Applications are expected to adhere to PCI DSS standards meant for Data protection, Access Regulation and so on. Dedicated SOC Team,consisting of Security analyst who are continously on the prawl to identify breach, conduct periodic auditing of Applications, hardening of Servers.
While all our .NET applications adhere to below guidelines,
ASP.NET Security Overview Secure Coding Guidelines Security Guidelines by OWASP We also use tools like Snyk to perform code vulnerability analysis as part of Jenkins driven CI/CD pipeline.</description><content type="html"><![CDATA[<p>At my current workplace, All Applications are expected to adhere to  <a href="https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard">PCI DSS standards</a> meant for Data protection, Access Regulation and so on.  Dedicated <a href="https://en.wikipedia.org/wiki/Information_security_operations_center">SOC</a> Team,consisting of Security analyst who are continously on the prawl to identify breach, conduct periodic auditing of Applications, hardening of Servers.</p>
<p>While all our .NET applications adhere to below guidelines,</p>
<ul>
<li><a href="https://support.microsoft.com/en-in/help/891028/asp-net-security-overview">ASP.NET Security Overview</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/standard/security/secure-coding-guidelines">Secure Coding Guidelines</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html">Security Guidelines by OWASP</a></li>
</ul>
<p>We also use tools like <a href="https://www.snyk.io/">Snyk</a> to perform code vulnerability analysis as part of Jenkins driven CI/CD pipeline. In spite of above, we do come across  vulnerabilities identified by SOC Team which we needs to be addressed quickly. SOC team uses tools such as <a href="https://portswigger.net/burp">Burp Suite</a>.</p>
<p>This post is going to summarize such incidents reported so far (and will keep updating it). In most of these cases, These issues required additional efforts over and above those provided by library or framework. Hopefully, it will be helpful to anyone trying address such vulnerabilities.</p>
<h3 id="cookie-path">Cookie Path</h3>
<p>Every cookie being sent by the Web application has attributes like,</p>
<ul>
<li>HTTPOnly - Indicates whether a cookie is accessible by client-side script</li>
<li>Domain - Indicates the domain to associate the cookie with</li>
<li>Path - the virtual path to transmit with the current cookie</li>
<li>Secure - Indicates whether cookie is sent only on Secure (HTTPS) Connections.</li>
</ul>
<p>OWASP has nice primer on <a href="https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20171130_Cookie_Security_Myths_Misconceptions_David_Johansson.pdf">Cookie Security</a>.</p>
<p>Of the above, <strong>Path</strong> attribute limits the scope of a cookie to a specific path on the server and can therefore be used to prevent unauthorized access to it from other applications on the same host.  Accordingly, SOC Team had recommended that all cookies issued by application must have path attribute set.</p>
<p>In case of typical ASP.NET Application, there are cookies generated by .NET framework (like for Session, Anti XSRF Token and son on) and custom ones which are issued and used by Application itself.</p>
<p>While it is fairly easy to set path for custom ones, we had to make code changes for cookies issued by .NET framework libraries. Lets take case of <a href="https://docs.microsoft.com/en-us/previous-versions/iis/6.0-sdk/ms525506(v%3Dvs.90)">Session ID</a> cookie, by default, this cookie always has root <code>/</code> as path. So how can this be changed as per the application&rsquo;s deployment settings (i.e. specific virtual directory in IIS)?</p>
<p>We tried below,</p>
<ul>
<li>Step 1, try using <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpcookiessection?view=netframework-4.8">httpcookies</a> section in web.config like,</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">    &lt;httpCookies requireSSL=&#34;false&#34; httpOnlyCookies=&#34;true&#34;  domain=&#34;site.com/myapp&#34;/&gt;
</code></pre></div><p>First of all, this configuration element does not allow setting <strong>Path</strong> property and even during runtime, only the <strong>Domain</strong> property is populated while issuing the cookie. So this definitely does not help address the issue.</p>
<p>So other way is to programmatically set the path for Session Cookie. This can be done by providing custom implementation of SessionIDManager class like below,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">  public class MySessionIDManager : SessionIDManager, ISessionIDManager
    {
        void ISessionIDManager.SaveSessionID(HttpContext context, string id, out bool redirected, out bool cookieAdded)
        {
            base.SaveSessionID(context, id, out redirected, out cookieAdded);

            if (cookieAdded)
            {
                var name = &#34;ASP.NET_SessionId&#34;;
                var cookie = context.Response.Cookies[name];
                // this will be possibly read from configuration
                cookie.Path = &#34;/myapp&#34;; 
           }
        }
    }

</code></pre></div><p>Thanks to <a href="https://stackoverflow.com/questions/2326521/asp-net-session-cookies-specifying-the-base-domain">this</a> Stackoverflow thread for listing this approach. Application under consideration only had this particular cookie however, for all other .NET framework issued cookies, similar technique will have to be used.</p>
<h3 id="samesite-cookie">SameSite Cookie</h3>
<p>This is already detailed <a href="/posts/samesitecookies">here</a></p>
<h3 id="masking-of-sensitive-data">Masking of Sensitive Data</h3>
<p>This typically involves masking the sensitive data like</p>
<ul>
<li>E-mail id</li>
<li>Phone Number</li>
<li>Credit/Debit Card Number</li>
</ul>
<p>It could well be used in Web Application or be received or sent as part of HTTP API.</p>
<p>The best bet in this case is to mask it on the server side itself before sending/rendering the data in browser. Note that, in some cases, above fields are used for data binding purposes. The approach we followed in such scenario was to use Hash value of it instead of merely masking the data. We have always used <a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.sha256?view=netcore-3.1">SHA256</a> or above for hashing.</p>
<h2 id="summary">Summary</h2>
<p>Addressing security vulnerabilities is continuous process as hackers keep on inventing new ways for breaching and exploiting weak spots. As Application Architect/Developers, we need to brace ourselves for the same.</p>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Is WebAssembly future of Web Development</title><link>https://sachinsu.github.io/posts/webassembly/</link><pubDate>Tue, 02 Jun 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/webassembly/</guid><description>Over the last many years, de-facto language of the Web (specifically front-end) has been Javascript (and variants like Typescript, ECMAScript versions and so on). The Web development has been revolving around HTML+CSS+Javascript trio. It all started with support for Javascript in browsers, followed by addition of XMLHTTP API, Rich DOM Manipulation Support in Javascript. To induce order and apply patterns to Javascript&amp;rsquo;s usage in browsers, numerous frameworks and libraries were introduced like React and Vue among others.</description><content type="html"><![CDATA[<p>Over the last many years, de-facto language of the Web (specifically front-end) has been Javascript (and variants like Typescript, ECMAScript versions and so on). The Web development has been revolving around HTML+CSS+Javascript trio. It all started with support for Javascript in browsers, followed by addition of XMLHTTP API, Rich DOM Manipulation Support in Javascript. To induce order and apply patterns to Javascript&rsquo;s usage in browsers, numerous frameworks and libraries were introduced like <a href="https://reactjs.org">React</a> and <a href="https://vuejs.org">Vue</a> among others. To begin with, The target used to be browsers on Large Devices like Desktop &amp; Laptops. However, soon all sorts of devices were targetted with advent of Responsive and Progressive CSS+Javascript libraries eg. <a href="https://getbootstrap.com">Bootstrap</a>. Offline Support soon came in ref: <a href="https://electronjs.org">Electron</a> and <a href="https://web.dev/progressive-web-apps/">Progressive Web Applications</a>.</p>
<p>As a result, Javascript has become lingua franca of Web Development and is being used on server side development (<a href="https://nodejs.org">Nodejs</a>).</p>
<p>The reason for this whole rant on history (which you are most likely to be aware of) is that latest kid on the Block could possibly challenge Monopoly of Javascript (and its ilk) at far as browsers are concerned.</p>
<p><em><strong>Enter WebAssembly (A.K.A. WASM)</strong></em></p>
<h2 id="webassembly">WebAssembly</h2>
<p>As per <a href="https://en.wikipedia.org/wiki/WebAssembly">Wikipedia</a>,</p>
<blockquote>
<p>WebAssembly (often shortened to Wasm) is an open standard that defines a portable binary-code format for executable programs, and a corresponding textual assembly language, as well as interfaces for facilitating interactions between such programs and their host environment.</p>
</blockquote>
<blockquote>
<p>WebAssembly or wasm is a low-level bytecode format for in-browser client-side scripting, evolved from JavaScript. It is <a href="https://evilmartians.com/chronicles/hands-on-webassembly-try-the-basics">intermidiate representation</a>(IR) where IR is transformed into machine instructions for the client architecture by browser.</p>
</blockquote>
<p>WebAssembly executables are precompiled, hence it is possible to use a variety of programming languages to make them. This essentially means that one can use same language for Server Side as well as Client side (i.e. in browser) development like (<a href="https://docs.microsoft.com/en-us/dotnet/csharp/">C#</a> or <a href="https://golang.org/">Golang</a>).</p>
<p>WebAssembly was announced in 2015 and has since being supported by prominent browser(s) like Chrome and Firefox.</p>
<p>Along side browsers, many Vendors and open source communities/contributors have released libraries to make development of WebAssembly easy.  We will look at how a WebAssembly can be developed in C# and Golang.</p>
<p><em>Note: <a href="https://github.com/appcypher/awesome-wasm-langs">All major languages</a> now support WebAssembly.</em></p>
<h3 id="c">C#</h3>
<p>During Microsoft Build 2020 <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> event, Steve Sanderson had very good session on building WebAssembly using Blazor framework in .NET. Highly recommended to watch it.</p>
<p>Blazor scaffolding provided with .NET core allows,</p>
<ul>
<li>
<p>Blazor Server App - A Template that runs server-side inside an ASP.NET Core app and handles user interactions over a SignalR connection.</p>
</li>
<li>
<p>Blazor WebAssembly App - A Template for creating a Blazor app that runs on WebAssembly.</p>
</li>
</ul>
<p>Choosing Blazor WebAssembly App project type generates a project that has sample WebAssembly running. Overall, it makes development easy for any .NET developer easy since, it uses<a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/razor?view=aspnetcore-3.1">Razor</a> syntax to add C# code along with HTML. During Build, it generates assembly for C# Code. When Accessed via browser, it downloads .NET runtime for WebAssembly (~ 621 KB) and the project assembly itself apart from static content (i.e. HTML files, images etc). The default scafolding includes Bootstrap CSS and prepares the UI to be responsive.</p>
<p>The repository referenced by Steve during presentation is available <a href="https://aka.ms/blazor-carchecker">here</a>.</p>
<h3 id="golang">Golang</h3>
<p><a href="https://golang.org">Go</a> has got clean, fast tooling. it produces static binaries and has superb concurrency primitives.</p>
<p><a href="https://www.vugu.org/">Vugu</a> is an open source library that allows building a Web front-end in Go using WebAssembly. Generally static binaries are bulky and Vugu has addressed it using <a href="https://tinygo.org">TinyGo</a> compiler. Vugu is still work in progress but does work great in its current form.  Check out their <a href="https://www.vugu.org/doc/start">getting started</a> page.</p>
<p>Interesting take on Journey of JavaScript and what lies ahead for it, read it <a href="https://www.swyx.io/writing/js-third-age/">here</a>.</p>
<h2 id="summary">Summary</h2>
<p>In nutshell, Concept of WebAssembly provides compelling way to have full stack development in a language of your choice. It remains to be seen how and whether it provides viable alternative to current Javascript driven ecosystem.</p>
<h3 id="useful-references">Useful References,</h3>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://channel9.msdn.com/Events/Build/2020/BOD104">Modern Web UI with Blazor</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
]]></content></item><item><title>Using Github Actions for Automated Testing and Deployment</title><link>https://sachinsu.github.io/posts/usinggithubactions/</link><pubDate>Thu, 28 May 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/usinggithubactions/</guid><description>Background The source code of tracfee.com is hosted on Github Private.
At a High level, Tracfee&amp;rsquo;s Architecture involves,
Single Page Application using VueJS, deployed on Netlify API in Go, deployed on Oracle Cloud So far, API testing has been automated and we were looking at ways to automate deployment of both UI and API. Steps required to deploy API are less since we are using Docker to run it on VM.</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>The source code of <a href="https://tracfee.com">tracfee.com</a> is hosted on Github Private.</p>
<p>At a High level, Tracfee&rsquo;s Architecture involves,</p>
<ul>
<li>Single Page Application using VueJS, deployed on <a href="https://netlify.com">Netlify</a></li>
<li>API in <a href="https://golang.org">Go</a>, deployed on <a href="https://www.oracle.com/in/cloud/">Oracle Cloud</a></li>
</ul>
<p>So far, API testing has been automated and we were looking at ways to automate deployment of both UI and API. Steps required to deploy API are less since we are using Docker to run it on VM. However, in case of Netlify, it is required to build and then upload the output folder on Netlify.</p>
<p>Accordingly, it was decided to explore Github actions to automate deployment.</p>
<h2 id="using-github-actions">Using Github actions</h2>
<p>As per <a href="https://github.com/features/actions">Github</a>,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">GitHub Actions makes it easy to automate all your software workflows, now with world-class CI/CD. Build, test, and deploy your code right from GitHub. Make code reviews, branch management, and issue triaging work the way you want.
</code></pre></div><p>GitHub actions work by provisioning Virtual machine to run an Event based workflow. It provides option to provision Linux/MacOS/Windows based Virtual machines. Steps in Workflow will have to be configured in <a href="https://yaml.org">YAML</a> file. Trigger for Workflow can be (but not limited to) wide variety of events like on Push or commit on branch and so on.</p>
<p>Post trigger, set of action(s) can be configured like,</p>
<ul>
<li>Checkout the branch</li>
<li>Setup environment (Install <a href="https://github.com/actions/setup-node">Node.JS</a>)</li>
<li>Perform build</li>
<li>Deployment</li>
</ul>
<p>Github has Marketplace which has many pre-built actions available. My requirement was to,</p>
<ul>
<li>Provision Linux (i.e. ubuntu-latest) Virtual Machine</li>
<li>Checkout the code (using <a href="https://github.com/actions/checkout">actions/checkout@v2</a>)</li>
<li>Setup Node.js (using <a href="https://github.com/actions/setup-node">actions/setup-node</a>)</li>
<li>perform Build and test using <a href="https://www.npmjs.com/">NPM</a></li>
<li>Deploy to Netlify using <a href="https://github.com/netlify/actions">netlify/actions/cli@master</a></li>
<li>Any secrets required as part of Workflow can be maintained using <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets">Github secrets</a></li>
</ul>
<p>Above workflow needs to be maintained in <code>.github\workflows</code> folder in the repository.</p>
<p>build.yml for <a href="https://tracfee.com">tracfee.com</a> looks like,</p>

<iframe src="//carbon.now.sh/embed/f98fbca1049e15f0360c140610fa4cc4"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>

<p>Refer Gist <a href="https://gist.github.com/sachinsu/f98fbca1049e15f0360c140610fa4cc4">here</a>.</p>
<h2 id="testing-the-build-workflow">Testing the Build Workflow</h2>
<p>After configuring the workflow steps, next question is to check whether it is possible to test it locally? Luckily, there is tool available to do this. Enter <a href="https://github.com/nektos/act">Act</a> , which is a tool to  <code>Run your GitHub Actions locally </code>.  Local testing is useful for Faster feedback. In Nutshell, Act uses local docker setup to provision container and then runs workflow steps in it. Give it a try !!</p>
<p>As a next step, Plan is to automate deployment of API on Oracle Cloud using OCI CLI interface.</p>
<h3 id="useful-references">Useful References,</h3>
<ul>
<li><a href="https://medium.com/@MarekPukaj/build-with-github-actions-host-on-netlify-ebf5fa505616">Build with GitHub Actions, host on Netlify</a></li>
<li><a href="https://blogs.oracle.com/developers/adventures-in-cicd-4-deploying-a-microservice-to-the-oracle-cloud-with-github-actions-oci-cli-edition">Adventures in CI/CD [#4]: Deploying A Microservice To The Oracle Cloud With GitHub Actions [OCI CLI Edition]</a></li>
</ul>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Windows Service with Cancelable Task</title><link>https://sachinsu.github.io/posts/windowsservicecancellabletask/</link><pubDate>Tue, 05 May 2020 12:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/windowsservicecancellabletask/</guid><description>Background Recently, we had requirement wherein a process should,
Periodically (Poll) or Asynchronously (Pub-sub) listen on incoming requests/messages. The whole process is expected to be long running. Should also implement clean disposal of in-flight requests and subsequent cleanup using something similar to Cancelble Context in Go The first of the objective is somewhat dependent on mechanism (Pub/sub, Listener), protocol (TCP, HTTP etc.). For the second one, .NET framework (and .</description><content type="html"><![CDATA[<h3 id="background">Background</h3>
<p>Recently, we had requirement wherein a process should,</p>
<ul>
<li>Periodically (Poll) or Asynchronously (Pub-sub) listen on incoming requests/messages. The whole process is expected to be long running.</li>
<li>Should also implement clean disposal of in-flight requests and subsequent cleanup using something similar to Cancelble <a href="https://golang.org/pkg/context/">Context</a> in Go</li>
</ul>
<p>The first of the objective is somewhat dependent on mechanism (Pub/sub, Listener), protocol (TCP, HTTP etc.). For the second one, .NET framework (and .NET Core) offers <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.cancellationtoken?view=netcore-3.1">CancellationToken</a>. It is maint for co-operative cancellation between threads and Task Objects. So Armed with this, is it possible to come up with a template that allows cancellation of long running task while also being deployed as Windows Service (or using systemd in Linux) ?</p>
<p>Lets get Started,</p>
<h3 id="approach">Approach</h3>
<p>We can use below to construct service,</p>
<ul>
<li><a href="http://topshelf-project.com/">Topshelf</a> - Allows Hosting  services in-process as console apps or Windows services.</li>
<li><a href="htps://nlog-project.org">NLog</a> - For Logging</li>
</ul>
<p>Accordingly, we will have below Components,</p>
<ul>
<li>Listener.cs - It wraps the long running process in a C# Task. It exposes Start and Stop functions which are essentially event handlers awaiting for Signal from the service.</li>
</ul>

<iframe src="//carbon.now.sh/embed/b2869d4f44fe14f439c6f0e60ea2b5d5?filename=Queuelistener.cs"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>

<p>Refer Gist <a href="https://gist.github.com/sachinsu/b2869d4f44fe14f439c6f0e60ea2b5d5#file-queuelistener-cs">here</a></p>
<ul>
<li>Program.cs - It configures the startup parameters for the service and initializes it. Using Topshelf, one can easily debug it as Console Application before deploying it as Service.</li>
</ul>

<iframe src="//carbon.now.sh/embed/b2869d4f44fe14f439c6f0e60ea2b5d5?filename=Program.cs"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>

<p>Refer Gist <a href="https://gist.github.com/sachinsu/b2869d4f44fe14f439c6f0e60ea2b5d5#file-program-cs">here</a></p>
<p>Above Code was targetted at .NET Framework but the same can potentially be used on .NET Core thus targetting both Windows and Linux.</p>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Optimizing .NET Code using Benchmarks</title><link>https://sachinsu.github.io/posts/usingbenchmarkdotnet/</link><pubDate>Tue, 05 May 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/usingbenchmarkdotnet/</guid><description>Background Oftentimes, we come across situation where code does not perform as per expectation. What is typically approch to address it,
Performance Testing - Visual Studio Load Tests or Third party tools like Locust, Vegeta, Gatling etc. Visual Studio Diagnostics Tools Or Use tools like Perfview/dotTrace/dotMemory to diagnose bottlenecks What if it is possible to Benchmark code for,
Set of varying parameter(s) Different runtimes (.NET Framework versions, .</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>Oftentimes, we come across situation where code does not perform as per expectation. What is typically approch to address it,</p>
<ul>
<li>Performance Testing - Visual Studio Load Tests or Third party tools like  <a href="https://locust.io/">Locust</a>, <a href="https://github.com/tsenart/vegeta">Vegeta</a>, <a href="https://gatling.io/">Gatling</a> etc.</li>
<li>Visual Studio Diagnostics Tools Or</li>
<li>Use tools like Perfview/dotTrace/dotMemory to diagnose bottlenecks</li>
</ul>
<p>What if it is possible to Benchmark code for,</p>
<ul>
<li>Set of varying parameter(s)</li>
<li>Different runtimes (.NET Framework versions, .NET core, Mono etc.) with option to Benchmark it</li>
<li>Observe Memory Allocations for diagnostics</li>
<li>Get Detailed report on execution timeline</li>
<li>Have it as part of test suite so that it can be easily executed with every iteration involving optimized code to get immediate feedback</li>
</ul>
<p>Enter <a href="https://benchmarkdotnet.org/">BenchmarkDotNet</a>, a Powerful .NET library for benchmarking. It is used by <a href="https://github.com/dotnet/performance">DotNET</a> Team, Roslyn, ASP.NET Core and many other projects.</p>
<p>Though <a href="https://benchmarkdotnet.org/">Benchmarkdotnet.org</a> has nice documentation with detailed examples, Below we will look at how to benchmark a code which is aimed at dumping in-memory list of objects to a delimited file. In real-world scenario, the list of objects could be retrieved from external data store.</p>
<p>So Lets Start.</p>
<h2 id="approach">Approach</h2>
<p>We will have below before we proceed with using BenchmarkDotNet</p>
<ul>
<li>Dummy class that represents Data Structure to be dumped to a file,</li>
</ul>
<p><code>
<iframe src="//carbon.now.sh/embed/b2d914a563b49d4dd50a4143166f27ec"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>
</code></p>
<p>Refer Gist <a href="https://gist.github.com/sachinsu/b2d914a563b49d4dd50a4143166f27ec">here</a></p>
<ul>
<li>
<p>Class <code>CardWriter.cs</code> that generates file using,</p>
<ul>
<li>Using <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.streamwriter?view=netcore-3.1">StreamWriter</a> with Buffer</li>
<li>Using Stringbuilder and StreamWriter</li>
<li>Using Open source <a href="https://joshclose.github.io/CsvHelper/">CSVHelper</a> library</li>
</ul>
</li>
</ul>
<p><code>
<iframe src="//carbon.now.sh/embed/b2d914a563b49d4dd50a4143166f27ec?filename=CardWriter.cs"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>
</code></p>
<p>Refer Gist <a href="https://gist.github.com/sachinsu/b2d914a563b49d4dd50a4143166f27ec#file-cardwriter-cs">here</a></p>
<ul>
<li>Now, let us write code to benchmark above functions with Memory Diagnostics,</li>
</ul>
<p><code>
<iframe src="//carbon.now.sh/embed/b2d914a563b49d4dd50a4143166f27ec?filename=Program.cs"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>
</code></p>
<p>Refer Gist <a href="https://gist.github.com/sachinsu/b2d914a563b49d4dd50a4143166f27ec#file-program-cs">here</a></p>
<p>Above code,</p>
<ul>
<li>Class <code>FileGeneratorBenchmark</code> - This class uses BenchmarkDotNET attributes to decorate set of functions which in turn call functions from <code>CardWriter.cs</code> class.</li>
<li>Class <code>Program</code> - General purpose class with static <code>main</code> function that invokes <code>BenchmarkRunner</code> to execute benchmarks.</li>
</ul>
<p>It is required to run these benchmarks in <code>Release</code> mode or else BenchmarkDotNet will alert about the same. After running the benchmark, It will generate detailed report like below,</p>
<p><img src="/images/capture.png" alt="Benchmark Result"></p>
<p>Report shows Memory Allocation as well as Execution time lines across  Platform (.NET Framework Vesions) and parameters.</p>
<p>References:</p>
<ul>
<li><a href="https://benchmarkdotnet.org">BenchmarkDotNet</a></li>
<li><a href="https://www.stevejgordon.co.uk/introduction-to-benchmarking-csharp-code-with-benchmark-dot-net">Introduction to Benchmarking C# Code with Benchmark .NET</a></li>
</ul>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>ASP.NET Core - Mind the SameSite HTTP Cookie settings</title><link>https://sachinsu.github.io/posts/samesitecookies/</link><pubDate>Thu, 09 Apr 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/samesitecookies/</guid><description>Background A Web Application, developed in ASP.NET Core (Runtime Version 3.1.100) using Razor Pages and Web API, is expected to be launched from within third-party Web Application in iframe, with complete HTML being rendered.
During the Development, a mock HTML Page was developed to simulate launching of ASP.NET core based Web Application in iframe. Note that this page as well as Application was hosted on same IIS Server and it worked fine.</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>A Web Application, developed in ASP.NET Core (Runtime Version 3.1.100) using Razor Pages and Web API, is expected to be launched from within third-party Web Application in iframe, with complete HTML being rendered.</p>
<p>During the Development, a mock HTML Page was developed to simulate launching of ASP.NET core based Web Application in iframe. Note that this page as well as Application was hosted on same IIS Server and it worked fine. Subsequently, Web Application was deployed on Test Server and URL was shared for integration with third party Application and then it happened Boom&hellip;. i.e. Application when launched in iframe rendered HTML but none of the post request would work (returning HTTP Error 400). Careful inspection showed that,</p>
<ul>
<li>
<p>Browser&rsquo;s <a href="https://developers.google.com/web/tools/chrome-devtools">Dev tools</a> showed HTTP 400</p>
</li>
<li>
<p>There were no entries in Application&rsquo;s Log File which indicates that Request was rejected either by IIS or ASP.NET Core&rsquo;s chain of filters i.e. even before it reaches handler.</p>
</li>
<li>
<p>IIS Log depicted that Request was rejected but had no additional details. May be some of the log settings were missing.</p>
</li>
<li>
<p>Next up is to carefully look at Request sent by browser in &lsquo;Network&rsquo; tab of Dev tools. It showed that none of the cookies required by Application (i.e. for Session, CSRF token etc.) were present.</p>
</li>
</ul>
<p>Enter <a href="https://docs.microsoft.com/en-us/aspnet/core/security/samesite?view=aspnetcore-3.1">SameSite</a></p>
<h4 id="samesite">SameSite</h4>
<p>SameSite is a standard designed to provide some protection against cross-site request forgery (CSRF) attacks. Support for Samesite was added from .NET Core 2.2 and onwards. It is expected that developer will control the value of SameSite attribute using <code>HttpCookie.SameSite</code> property.Setting the SameSite property to Strict, Lax, or None results in those values being written on the network with the cookie.</p>
<ul>
<li>Cookies without SameSite header are treated as SameSite=Lax by default.</li>
<li>SameSite=None must be used to allow cross-site cookie use.</li>
<li>Cookies that assert SameSite=None must also be marked as Secure.</li>
<li>Applications that use <code>&lt;iframe&gt;</code> may experience issues with sameSite=Lax or sameSite=Strict cookies because <code>&lt;iframe&gt;</code> is treated as cross-site scenarios.</li>
<li>The value SameSite=None is not allowed by the 2016 standard and causes some implementations to treat such cookies as SameSite=Strict. See Supporting older browsers in this document.</li>
</ul>
<p>The SameSite=Lax setting works for most application cookies.</p>
<p>Accordingly, below settings were made in startup.cs of the ASP.NET Core Application.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">services.AddSession(options =&gt;
            {
                options.IdleTimeout = TimeSpan.FromMinutes(30);
                options.Cookie.HttpOnly = true;
                // Samesite Settings.
                options.Cookie.SameSite = SameSiteMode.Lax;
                options.Cookie.IsEssential = true;
            });

services.AddAntiforgery(options =&gt;
{
    options.Cookie.SameSite = SameSiteMode.Lax;
});
</code></pre></div><h5 id="references">References</h5>
<ul>
<li><a href="https://techcommunity.microsoft.com/t5/iis-support-blog/samesite-cookie-updates-in-asp-net-or-how-the-net-framework-from/ba-p/1156246">SameSite cookie updates in ASP.net, or how the .Net Framework from December changed my cookie usage. </a></li>
<li><a href="https://techcommunity.microsoft.com/t5/iis-support-blog/changes-in-samesite-cookie-in-asp-net-core-and-how-it-impacts/ba-p/1150771">Changes in SameSite Cookie in ASP.NET/Core and How it Impacts the Browser (Specifically Chrome) </a></li>
<li><a href="https://http203.libsyn.com/fish-scripts-special">HTTP 203 Podcast covering CORS,CORB, Samesite</a></li>
</ul>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Using Channels for High performance Producer consumer implementation</title><link>https://sachinsu.github.io/posts/channelsforproducerconsumer/</link><pubDate>Wed, 12 Feb 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/channelsforproducerconsumer/</guid><description>Background Recently, i got involved in assignment where in an application was facing issues with throughput. Expectation is to support more than 500 transactions per second while load testing results were indicating system was experiencing high latency beyond 100+ transactions per second.
This application is developed in .NET Framework + .NET Core and primarily uses Relational Database for persistence and has point to point integration (mainly over HTTP) with internal &amp;amp; external application(s).</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>Recently, i got involved in assignment where in  an application was facing issues with throughput. Expectation is to support more than 500 transactions per second while load testing results were indicating system was experiencing high latency beyond 100+ transactions per second.</p>
<p>This application is developed in .NET Framework + .NET Core and primarily uses Relational Database for persistence and has point to point integration (mainly over HTTP) with internal &amp; external application(s).</p>
<h2 id="approach">Approach</h2>
<p>The high level approach decided to perform diagnostics and subsequent corrective action(s) were,</p>
<ul>
<li>Benchmark code that involves Database and take corrective action</li>
<li>Identify tasks in hot code path that could potentially be decoupled or done in fire-n-forget mode.</li>
</ul>
<p>For point 2 from above, some of the tasks identified were,</p>
<ul>
<li>Sending Email/SMS on myriad of events</li>
<li>Integration with External Applications over HTTP</li>
</ul>
<p>Next task was to arrive at approach on how to perform them effectively outside of hot code path without incurring need of any additional resources (hardware or software)as far as possible. Accordingly, we had two options,</p>
<ul>
<li><em>Polling</em> - Periodically polling database to check for occurance of event and then performing the action.</li>
<li><em>Event Driven</em> - Using Event notification feature of database (e.g. <a href="https://www.postgresql.org/docs/current/sql-notify.html">Listen/Notify</a> in PostgreSQL or <a href="https://docs.oracle.com/cd/B28359_01/appdev.111/b28424/adfns_cqn.htm">Change Notification</a>/<a href="https://www.oracle.com/database/technologies/advanced-queuing.html">Advanced Queuing</a> in Oracle).</li>
</ul>
<p>We decided to go with <em>Event driven</em> as,</p>
<ul>
<li>Cleaner approach that doesn&rsquo;t require perodically checking for events thus consuming a database connection and more code.</li>
<li>We may have to have more than one such daemons to cater to different events in application.</li>
</ul>
<p>Post finalizing on event driven approach for gathering events, next task was to determine how to effectively send email/sms or any other HTTP requests considering that rate of arrival of events will not be matching rate of processing them. Also these</p>
<p>So what are the options available in .NET Ecosystem, Below are the ones i am aware of,</p>
<ul>
<li><a href="https://devblogs.microsoft.com/dotnet/an-introduction-to-system-threading-channels/">Channels</a> - High performance implementation of In-memory producer/consumer pattern.</li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/standard/parallel-programming/dataflow-task-parallel-library">TPL Dataflow</a> - Super set of Channels Library. Aimed at use cases where blocks of logic are to be linked together to same or different consumers and so on. Also all these features come with additional overheads.</li>
</ul>
<p>For the task at hand, functionality offered by Channels is sufficient to implement in-memory producer consumer pattern.</p>
<p>So we wrapped above event processing in a Windows service implemented as <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-3.1&amp;tabs=visual-studio">.NET Core Worker
Service</a></p>
<p>Generic Implementation is as follows,</p>
<ul>
<li>
<p>Event Generator - In practice, this class will be responsible for wiring up to receive events from database</p>
</li>
<li>
<p>Event Consumer which uses channels to process events in parallel</p>
</li>
</ul>

<iframe src="//carbon.now.sh/embed/6fcbc36e6e5cc58c7b5ba9007e276afc"
    style="transform:scale(0.9); width:1024px; height:473px; border:0; overflow:hidden;"
    sandbox="allow-scripts allow-same-origin">
</iframe>

<p>Refer Gist <a href="https://gist.github.com/sachinsu/6fcbc36e6e5cc58c7b5ba9007e276afc">here</a></p>
<h2 id="summary">Summary</h2>
<p>Other languages (notably <a href="https://tour.golang.org/concurrency/2">Channels in Go</a>) have been providing out of the box implementation for in-memory producer with concurrent, parallel consumers. With Channels, .NET Ecosystem finally has construct that can be effectively put to use for high performance, concurrent use cases.</p>
<h3 id="useful-references">Useful References,</h3>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/csharp/event-pattern#defining-and-raising-field-like-events">Event Pattern in C#</a></li>
<li><a href="https://gist.github.com/AlgorithmsAreCool/b0960ce8a3400305e43fe8ffdf89b32c">Gist on using Channels</a></li>
</ul>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item><item><title>Using .NET standard Assembly in .NET core and .NET Framework</title><link>https://sachinsu.github.io/posts/dotnetstandard/</link><pubDate>Fri, 07 Feb 2020 10:25:04 +0530</pubDate><guid>https://sachinsu.github.io/posts/dotnetstandard/</guid><description>Background One of the key project(s) at my current organization is developed on .NET 4.6.1. It is developed as Modular Monolith. As part of it&amp;rsquo;s functionality, it supports different channels like Mobiles, Terminals and Web. For the Web channel, there was need to develop a Web application with,
High availability Lightweight, High throughput (Need to support few thousand(s) active users) Accordingly, we have been exploring developing this Web Application in .</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<p>One of the key project(s) at my current organization is developed on .NET 4.6.1. It is developed as <a href="https://www.youtube.com/watch?v=5OjqD-ow8GE">Modular Monolith</a>. As part of it&rsquo;s functionality, it supports different channels like Mobiles, Terminals and Web. For the <em>Web</em> channel, there was need to develop a Web application with,</p>
<ul>
<li>High availability</li>
<li>Lightweight, High throughput (Need to support few thousand(s) active users)</li>
</ul>
<p>Accordingly, we have been exploring developing this Web Application in .NET core 3.1. However, it also means that we will have to use class libraries, targeted at .NET framework 4.6.1, in .NET core and vice-versa. How can this be done?</p>
<p><strong>.NET Standard to the rescue !!</strong></p>
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/net-standard">.Net Standard</a> is a standard that enabled development of portable libraries usable across .NET versions.</p>
<p>Below is approach adopted to create usable libraries across .NET framework &amp; .NET Core.</p>
<ul>
<li>
<p>.NET &amp; IDE versions used are,</p>
<ul>
<li>.Net Framework 4.6.1</li>
<li>.Net core 3.1</li>
<li>Visual Studio 2015 - for .NET Framework 4.6.1 development</li>
<li>Visual Studio Code - For .NET core development</li>
</ul>
</li>
<li>
<p>Step 1 -</p>
<ul>
<li>Create a library that targets .NET Standard.
<ul>
<li>
<p>Refer to Table on <a href="https://docs.microsoft.com/en-us/dotnet/standard/net-standard#net-implementation-support">Implementation Support</a> to decide on version that can be targetted at. In my case, it was 2.0 (Remember that higher the version, more APIs will be available to use). Do check <a href="https://docs.microsoft.com/en-us/dotnet/api/">.NET API browser</a>, which lists API available with each version.</p>
</li>
<li>
<p>Using .NET core, use below command,
<code>dotnet new classlib &lt;name&gt;</code></p>
<p>Note that, by default csproj file generated targets .NET Standard, but do confirm by checking in <code>&lt;name&gt;.csproj</code> file, It should have entry like,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt;
&lt;/PropertyGroup&gt;
</code></pre></div><p>Change the version of .NET Standard if required.</p>
</li>
<li>
<p>Add necessary code to the library and build it using,
<code>dotnet build</code></p>
</li>
<li>
<p>Create a Nuget Package using,
<code>dotnet pack</code>
This will generate <code>&lt;name&gt;1.0.0.nupkg</code> package in bin\debug folder (assuming that you are using Debug mode)</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Step 2 -</p>
<ul>
<li>
<p>Lets consume this library from console Application, using .NET Framework 4.6.1, in Visual Studio 2015.</p>
<ul>
<li>
<p>Create New Console Application and ensure that it is targeted at .NET Framework 4.6.1 or Higher.</p>
</li>
<li>
<p>Before consuming .NET standard library, few steps are needed since VS 2015 only has legacy support for consuming .NET core artifacts also it does not have latest version of Nuget, so lets do below,</p>
<ul>
<li>Install NuGet 3.6.0 or higher for VS 2015 from <a href="https://www.nuget.org/downloads">NuGet&rsquo;s download site</a></li>
<li>Install the &ldquo;.NET Standard Support for Visual Studio 2015&rdquo; from <a href="https://www.microsoft.com/net/download/core">here</a></li>
<li>Open the csproj file in Text Editor and add  <code>&lt;ImplicitlyExpandDesignTimeFacades&gt;</code> tag as shown in below example,</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;Project ToolsVersion=&#34;12.0&#34; DefaultTargets=&#34;Build&#34; xmlns=&#34;http://schemas.microsoft.com/developer/msbuild/2003&#34;&gt;
&lt;PropertyGroup&gt;
    &lt;Configuration Condition=&#34; &#39;$(Configuration)&#39; == &#39;&#39; &#34;&gt;Debug&lt;/Configuration&gt;
    &lt;Platform Condition=&#34; &#39;$(Platform)&#39; == &#39;&#39; &#34;&gt;AnyCPU&lt;/Platform&gt;
    &lt;ProjectGuid&gt;{75678902-8224-4222-BB33-756784B2FA29}&lt;/ProjectGuid&gt;
    &lt;OutputType&gt;Library&lt;/OutputType&gt;
    &lt;RootNamespace&gt;FooBar&lt;/RootNamespace&gt;
    &lt;AssemblyName&gt;FooBar&lt;/AssemblyName&gt;
    &lt;TargetFrameworkVersion&gt;v4.6.1&lt;/TargetFrameworkVersion&gt;
    ...
    &lt;ImplicitlyExpandDesignTimeFacades&gt;false&lt;/ImplicitlyExpandDesignTimeFacades&gt;
&lt;/PropertyGroup&gt;
</code></pre></div><p>Post update to file, VS 2015 will prompt to reload the project.</p>
<p>Now we are set to consume .NET standard library, authored in .NET Core, in this project.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Step 3 -</p>
<ul>
<li>Within VS 2015, Goto Nuget Console and install the package created earlier. This <a href="https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio">link</a> has steps to consume local nuget package(s).</li>
</ul>
</li>
</ul>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>
]]></content></item></channel></rss>